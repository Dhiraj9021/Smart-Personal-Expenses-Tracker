<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Smart Expense Tracker</title>
<style>
* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
}

body {
  background-color: #f8fafc;
  color: #334155;
  line-height: 1.6;
  padding: 20px;
  max-width: 1200px;
  margin: 0 auto;
}

/* Header */
.header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 30px;
  padding: 20px;
  background: white;
  border-radius: 16px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
}

.header h1 {
  color: #1e293b;
  font-size: 28px;
  display: flex;
  align-items: center;
  gap: 12px;
}

.header h1::before {
  content: "üìä";
  font-size: 28px;
}

.month-filter {
  display: flex;
  align-items: center;
  gap: 12px;
}

.month-filter input {
  padding: 10px 15px;
  border: 1px solid #e2e8f0;
  border-radius: 8px;
  font-size: 16px;
}

.month-filter button {
  padding: 10px 20px;
  background: #3b82f6;
  color: white;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  font-weight: 500;
  transition: background 0.2s;
}

.month-filter button:hover {
  background: #2563eb;
}

/* Summary Cards */
.summary-container {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 20px;
  margin-bottom: 30px;
}

.summary-card {
  background: white;
  border-radius: 16px;
  padding: 24px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
  display: flex;
  flex-direction: column;
  transition: transform 0.2s;
}

.summary-card:hover {
  transform: translateY(-4px);
}

.summary-card.income {
  border-top: 6px solid #10b981;
}

.summary-card.expense {
  border-top: 6px solid #ef4444;
}

.summary-card.balance {
  border-top: 6px solid #3b82f6;
}

.card-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 15px;
}

.card-header h3 {
  font-size: 18px;
  font-weight: 600;
  color: #64748b;
}

.card-icon {
  width: 44px;
  height: 44px;
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 20px;
}

.income .card-icon {
  background: rgba(16, 185, 129, 0.1);
  color: #10b981;
}

.expense .card-icon {
  background: rgba(239, 68, 68, 0.1);
  color: #ef4444;
}

.balance .card-icon {
  background: rgba(59, 130, 246, 0.1);
  color: #3b82f6;
}

.card-amount {
  font-size: 32px;
  font-weight: 700;
  margin-bottom: 8px;
}

.income .card-amount {
  color: #10b981;
}

.expense .card-amount {
  color: #ef4444;
}

.balance .card-amount {
  color: #1e293b;
}

.card-trend {
  font-size: 14px;
  color: #64748b;
  display: flex;
  align-items: center;
  gap: 5px;
}

.trend-positive {
  color: #10b981;
}

.trend-negative {
  color: #ef4444;
}

/* Actions */
.actions-container {
  display: flex;
  gap: 15px;
  margin-bottom: 30px;
  flex-wrap: wrap;
}

.action-btn {
  padding: 14px 24px;
  border-radius: 12px;
  border: none;
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 10px;
  transition: all 0.2s;
}

.action-btn.primary {
  background: #3b82f6;
  color: white;
}

.action-btn.primary:hover {
  background: #2563eb;
  box-shadow: 0 6px 20px rgba(37, 99, 235, 0.2);
}

.action-btn.secondary {
  background: white;
  color: #475569;
  border: 1px solid #e2e8f0;
}

.action-btn.secondary:hover {
  background: #f8fafc;
  border-color: #cbd5e1;
}

/* Sections */
.content-section {
  background: white;
  border-radius: 16px;
  padding: 24px;
  margin-bottom: 30px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
}

.section-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
}

.section-header h2 {
  font-size: 22px;
  color: #1e293b;
  font-weight: 700;
}

.view-all {
  color: #3b82f6;
  text-decoration: none;
  font-weight: 500;
  display: flex;
  align-items: center;
  gap: 5px;
}

.view-all:hover {
  text-decoration: underline;
}

/* Transaction Lists */
.transaction-list {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.transaction-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 16px;
  border-radius: 12px;
  background: #f8fafc;
  transition: background 0.2s;
}

.transaction-item:hover {
  background: #f1f5f9;
}

.transaction-info {
  flex: 1;
}

.transaction-title {
  font-weight: 600;
  color: #1e293b;
  margin-bottom: 4px;
}

.transaction-details {
  display: flex;
  align-items: center;
  gap: 15px;
  font-size: 14px;
  color: #64748b;
}

.transaction-category {
  background: #e2e8f0;
  padding: 4px 10px;
  border-radius: 20px;
  font-size: 12px;
  font-weight: 500;
}

.transaction-date {
  display: flex;
  align-items: center;
  gap: 5px;
}

.transaction-amount {
  font-size: 18px;
  font-weight: 700;
}

.amount-income {
  color: #10b981;
}

.amount-expense {
  color: #ef4444;
}

.empty-state {
  text-align: center;
  padding: 40px 20px;
  color: #94a3b8;
}

.empty-state p {
  margin-top: 10px;
}

/* Month selector */
.current-month {
  font-size: 16px;
  color: #475569;
  font-weight: 500;
  background: #f1f5f9;
  padding: 8px 16px;
  border-radius: 8px;
}

/* Category-wise Expenses */
  .category-container {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
  gap: 15px;
  margin-top: 20px;
}

.category-card {
  background: rgba(255,255,255,0.95);
  border-radius: 12px;
  padding: 15px;
  text-align: center;
  box-shadow: 0 6px 15px rgba(0,0,0,0.05);
}

.category-card h4 {
  margin-bottom: 8px;
  color: #555;
}

.category-card p {
  font-size: 20px;
  font-weight: bold;
  color: #e67e22;
}



/*pie chart */
.chart-box {
  width: 260px;
  margin: 20px auto;
  background: #ffffff;
  padding: 15px;
  border-radius: 12px;
  box-shadow: 0 8px 20px rgba(0,0,0,0.12);
  text-align: center;
}

.chart-box h4 {
  margin-bottom: 10px;
  font-size: 15px;
  color: #444;
}

#categoryChart {
  width: 200px !important;
  height: 200px !important;
  margin: auto;
}

/*logout and profile */
.top-right {
  position: fixed;
  top: 20px;
  right: 30px;
  display: flex;
  align-items: center;
  gap: 15px;
  z-index: 1000;
}

.profile {
  background: #ffffff;
  padding: 8px 14px;
  border-radius: 20px;
  font-weight: 600;
  box-shadow: 0 4px 10px rgba(0,0,0,0.15);
}

.logout {
  background: #ff4d4f;
  color: white;
  padding: 8px 14px;
  border-radius: 20px;
  text-decoration: none;
  font-weight: 600;
  box-shadow: 0 4px 10px rgba(0,0,0,0.15);
}

.logout:hover {
  background: #d9363e;
}


/* Footer */
.footer {
  text-align: center;
  padding: 20px;
  color: #94a3b8;
  font-size: 14px;
  margin-top: 20px;
}

/* Responsive */
@media (max-width: 768px) {
  .header {
    flex-direction: column;
    gap: 20px;
    align-items: flex-start;
  }
  
  .month-filter {
    width: 100%;
  }
  
  .month-filter input {
    flex: 1;
  }
  
  .transaction-details {
    flex-direction: column;
    align-items: flex-start;
    gap: 5px;
  }
  
  .transaction-item {
    flex-direction: column;
    align-items: flex-start;
    gap: 10px;
  }
  
  .transaction-amount {
    align-self: flex-end;
  }

}
</style>
</head>
<body>
<div class="top-right">
  <div class="profile">
    üë§ <span><%= userId.username %></span>
  </div>
  <a href="/auth/logout" class="logout">Logout</a>
</div>

<!-- HEADER -->
<div class="header">
  <div>
    <h1>Smart Expense Tracker</h1>
    <div class="current-month">April 2023</div>
  </div>
  
  <form method="GET" action="/dashboard" class="month-filter">
    <input type="month" name="month" value="2023-04">
    <button type="submit">Filter</button>
  </form>
</div>

<!-- SUMMARY CARDS -->
<div class="summary-container">
  <div class="summary-card income">
    <div class="card-header">
      <h3>Total Income</h3>
      <div class="card-icon">üí∞</div>
    </div>
    <div class="card-amount">‚Çπ <%= totalIncome %></div>
    <div class="card-trend">
      <span class="trend-positive">‚Üë 12% from last month</span>
    </div>
  </div>

  <div class="summary-card expense">
    <div class="card-header">
      <h3>Total Expense</h3>
      <div class="card-icon">üí∏</div>
    </div>
    <div class="card-amount">‚Çπ <%= totalExpense %></div>
    <div class="card-trend">
      <span class="trend-negative">‚Üë 8% from last month</span>
    </div>
  </div>

  <div class="summary-card balance">
    <div class="card-header">
      <h3>Remaining Balance</h3>
      <div class="card-icon">‚öñÔ∏è</div>
    </div>
    <div class="card-amount">‚Çπ <%= remaining %></div>
    <div class="card-trend">
      <span class="trend-positive">‚Üë 15% savings rate</span>
    </div>
  </div>
</div>

<!-- ACTIONS -->
<div class="actions-container">
  <button class="action-btn primary" onclick="window.location.href='/income/add'">
    <span>‚ûï</span> Add Income
  </button>
  
  <button class="action-btn primary" onclick="window.location.href='/test/add-expense'">
    <span>‚ûï</span> Add Expense
  </button>
  
  <button class="action-btn secondary" onclick="window.location.href='/income'">
    <span>üìÑ</span> View All Income
  </button>
  
  <button class="action-btn secondary" onclick="window.location.href='/test/expenses'">
    <span>üìÑ</span> View All Expenses
  </button>
</div>


<h2 style="margin-top:30px;">üè† Category-wise Expenses</h2>

<% if (categoryTotals && Object.keys(categoryTotals).length > 0) { %>
  <div class="category-container">
    <% for (let cat in categoryTotals) { %>
      <div class="category-card">
        <h4><%= cat %></h4>
        <p>‚Çπ <%= categoryTotals[cat] %></p>
        <h6><%= categoryPercentages[cat] %>%</h6>
      </div>
    <% } %>
  </div>
<% } else { %>
  <p>No expenses this month</p>
<% } %>


<div style="
  background:#f0f9ff;
  border-left:6px solid #3b82f6;
  padding:20px;
  border-radius:12px;
  margin:20px 0;
">
  <h3>ü§ñ AI Financial Insights</h3>
  <p style="white-space: pre-line;"></p>
</div>
<div class="chart-box">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<canvas id="categoryChart" width="40" height="40"></canvas>

<script>
  const categoryLabels = <%- JSON.stringify(Object.keys(categoryTotals)) %>;
  const categoryData = <%- JSON.stringify(Object.values(categoryTotals)) %>;

  new Chart(document.getElementById("categoryChart"), {
    type: "pie",
    data: {
      labels: categoryLabels,
      datasets: [{
        data: categoryData,
        backgroundColor: [
          "#ff6384", "#36a2eb", "#ffce56",
          "#4bc0c0", "#9966ff", "#ff9f40"
        ]
      }]
    }
  });
</script>
</div>

<% if (overspendAlerts.length > 0) { %>
  <div style="color:red; font-weight:bold;">
    ‚ö†Ô∏è Overspending Alert:
    <ul>
      <% overspendAlerts.forEach(alert => { %>
        <li><%= alert %></li>
      <% }) %>
    </ul>
  </div>
<% } %>
<div class="ai-card">
  <h3>ü§ñ AI Insight</h3>
  <p><%= aiInsight %></p>
</div>

<!-- RECENT INCOME -->
<div class="content-section">
  <div class="section-header">
    <h2>Recent Income</h2>
    <a href="/income" class="view-all">View All ‚Üí</a>
  </div>
  
  <div class="transaction-list">
    <% if(monthlyIncome.length === 0){ %>
      <div class="empty-state">
        <p>No income added this month</p>
      </div>
    <% } else { %>
      <% monthlyIncome.slice(0,5).forEach(inc => { %>
        <div class="transaction-item">
          <div class="transaction-info">
            <div class="transaction-title"><%= inc.title %></div>
            <div class="transaction-details">
              <span class="transaction-category"><%= inc.category %></span>
              <span class="transaction-date">üìÖ <%= inc.date %></span>
              <% if(inc.paymentMethod) { %>
                <span>üí≥ <%= inc.paymentMethod %></span>
              <% } %>
            </div>
          </div>
          <div class="transaction-amount amount-income">+ ‚Çπ <%= inc.amount %></div>
        </div>
      <% }) %>
    <% } %>
  </div>
</div>

<!-- RECENT EXPENSES -->
<div class="content-section">
  <div class="section-header">
    <h2>Recent Expenses</h2>
    <a href="/test/expenses" class="view-all">View All ‚Üí</a>
  </div>
  
  <div class="transaction-list">
    <% if(monthlyExpenses.length === 0){ %>
      <div class="empty-state">
        <p>No expenses added this month</p>
      </div>
    <% } else { %>
      <% monthlyExpenses.slice(0,5).forEach(exp => { %>
        <div class="transaction-item">
          <div class="transaction-info">
            <div class="transaction-title"><%= exp.title %></div>
            <div class="transaction-details">
              <span class="transaction-category"><%= exp.category %></span>
              <span class="transaction-date">üìÖ <%= exp.date %></span>
              <% if(exp.paymentMethod) { %>
                <span>üí≥ <%= exp.paymentMethod %></span>
              <% } %>
            </div>
          </div>
          <div class="transaction-amount amount-expense">- ‚Çπ <%= exp.amount %></div>
        </div>
      <% }) %>
    <% } %>
  </div>
</div>

<!-- FOOTER -->
<div class="footer">
  <p>Smart Expense Tracker ‚Ä¢ Track your finances with ease</p>
</div>

<script>
// Add some sample data for demonstration if needed
document.addEventListener('DOMContentLoaded', function() {
  // Set current month in filter
  const now = new Date();
  const currentMonth = now.getFullYear() + '-' + String(now.getMonth() + 1).padStart(2, '0');
  const monthInput = document.querySelector('input[type="month"]');
  if (monthInput && !monthInput.value) {
    monthInput.value = currentMonth;
  }
  
  // Format date display
  const monthNames = ["January", "February", "March", "April", "May", "June",
    "July", "August", "September", "October", "November", "December"
  ];
  
  const currentMonthElement = document.querySelector('.current-month');
  if (currentMonthElement) {
    currentMonthElement.textContent = monthNames[now.getMonth()] + ' ' + now.getFullYear();
  }
});
</script>
</body>
</html>